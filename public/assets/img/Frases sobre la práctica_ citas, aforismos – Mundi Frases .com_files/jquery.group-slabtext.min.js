(function($){$.fn.slabText=function(options){var settings={"fontRatio":0.78,"forceNewCharCount":true,"wrapAmpersand":true,"headerBreakpoint":null,"viewportBreakpoint":null,"noResizeEvent":false,"resizeThrottleTime":300,"maxFontSize":999,"postTweak":true,"precision":3};$("body").addClass("slabtexted");if(options){$.extend(settings,options);};var origFontSize=null,idealCharPerLine=null,fontRatio=settings.fontRatio,forceNewCharCount=settings.forceNewCharCount,headerBreakpoint=settings.headerBreakpoint,viewportBreakpoint=settings.viewportBreakpoint,resizeThrottleTime=settings.resizeThrottleTime,resizeThrottle=null,pixelFontSize=null,viewportWidth=$(window).width(),postTweak=settings.postTweak,precision=settings.precision;var grabPixelFontSize=function($that){if(pixelFontSize==null){var dummy=jQuery('<div style="display:none;font-size:1em;margin:0;padding:0;height:auto;line-height:1;border:0;">&nbsp;</div>').appendTo($that),emH=dummy.height();dummy.remove();pixelFontSize=emH;}
return pixelFontSize;};this.each(function(){var $this=$(this),keepSpans=$("span.slabtext",$this).length,words=keepSpans?[]:String($.trim($this.text())).replace(/\s{2,}/g," ").split(" "),parentWidth=$this.width();var resizeSlabs=function resizeSlabs(){var fs;$this.removeClass("slabtextdone slabtextinactive");if(viewportBreakpoint&&viewportBreakpoint>viewportWidth||headerBreakpoint&&headerBreakpoint>parentWidth){$this.addClass("slabtextinactive");return;};fs=grabPixelFontSize($this);if(!keepSpans&&(forceNewCharCount||fs!=origFontSize)){origFontSize=fs;var newCharPerLine=Math.min(60,Math.floor(parentWidth/(origFontSize*fontRatio))),wordIndex=0,lineText=[],counter=0,preText="",postText="",finalText="",preDiff,postDiff;if(newCharPerLine!=idealCharPerLine){idealCharPerLine=newCharPerLine;while(wordIndex<words.length){postText="";while(postText.length<idealCharPerLine){preText=postText;postText+=words[wordIndex]+" ";if(++wordIndex>=words.length){break;};};preDiff=idealCharPerLine-preText.length;postDiff=postText.length-idealCharPerLine;if((preDiff<postDiff)&&(preText.length>2)){finalText=preText;wordIndex--;}else{finalText=postText;};finalText=$('<div/>').text(finalText).html()
if(settings.wrapAmpersand){finalText=finalText.replace(/&amp;/g,'<span class="amp">&amp;</span>');}
finalText=$.trim(finalText)
lineText.push('<span class="slabtext">'+finalText+"</span>");};$this.data('slabtextcontent',lineText.join(" "));}}else{origFontSize=fs;};};resizeSlabs();});var slabtetxted=[];this.each(function(){var $this=$(this),headLink=false,linkTitle=headLink?$this.find("a:first").attr("title"):"",parentWidth=$this.width();var $clone=$this.clone();slabtetxted.push($clone);if(headLink){$clone.wrapInner('<a href="'+headLink+'" '+(linkTitle?'title="'+linkTitle+'" ':'')+'/>');};$("span.slabtext",$this).each(function(index){var $span=$(this),ratio,fontSize;if(postTweak){$clone.find("span.slabtext").eq(index).css({"word-spacing":0,"letter-spacing":0});};ratio=parentWidth/$span.width();fontSize=parseFloat(this.style.fontSize)||origFontSize;$clone.find("span.slabtext").eq(index).css("font-size",Math.min((fontSize*ratio).toFixed(precision),settings.maxFontSize)+"px");});});this.each(function(index){var $this=$(this);$this.replaceWith(slabtetxted[index]);});var posttwicked=[];$(slabtetxted).each(function(index){var $this=$(this),parentWidth=$this.width();var $clone=$this.clone();posttwicked.push($clone);$("span.slabtext",$this).each(function(index){var $span=$(this),innerText=$span.text(),wordSpacing=innerText.split(" ").length>1,diff;diff=!!postTweak?parentWidth-$span.width():false;if(diff){$clone.find("span.slabtext").eq(index).css((wordSpacing?'word':'letter')+'-spacing',(diff/(wordSpacing?innerText.split(" ").length-1:innerText.length)).toFixed(precision)+"px");};});});$(slabtetxted).each(function(index){posttwicked[index].addClass("slabtextdone");var $this=$(this);$this.replaceWith(posttwicked[index]);});return function(){};};})(jQuery);